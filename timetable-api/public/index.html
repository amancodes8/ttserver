<body>
  <h1>Your Timetable</h1>

  <label for="batchSelect">Select Batch:</label>
  <select id="batchSelect">
    <option value="E16">E16</option>
    <option value="E15">E15</option>
  </select>

  <div id="timetable">Loading...</div>

  <script>
    const API_KEY = '123abc456def789ghi'; // your API key here

    const batchSelect = document.getElementById('batchSelect');
    const timetableDiv = document.getElementById('timetable');

    function fetchTimetable(batch) {
      timetableDiv.textContent = 'Loading...';
      fetch(`http://localhost:3000/api/timetable?batch=${batch}`, {
        headers: { 'x-api-key': API_KEY }
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed to fetch');
        return res.json();
      })
      .then(data => {
        timetableDiv.innerHTML = '';
        console.log(data); // For debugging

        Object.entries(data).forEach(([day, subjects]) => {
          const dayDiv = document.createElement('div');
          dayDiv.className = 'day';
          dayDiv.innerHTML = `<h2>${day}</h2>`;

          subjects.forEach(({time, subject, room, teacher}) => {
            const subDiv = document.createElement('div');
            subDiv.className = 'subject';
            subDiv.textContent = `${time} â€” ${subject} | Room: ${room} | Teacher: ${teacher}`;
            dayDiv.appendChild(subDiv);
          });

          timetableDiv.appendChild(dayDiv);
        });
      })
      .catch(err => {
        timetableDiv.textContent = 'Error loading timetable.';
        console.error(err);
      });
    }

    batchSelect.addEventListener('change', () => {
      fetchTimetable(batchSelect.value);
    });

    // Initial load
    fetchTimetable(batchSelect.value);
  </script>
</body>
